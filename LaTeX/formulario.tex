% !TEX encoding = UTF-8
% !TEX program = pdflatex
\documentclass[a4paper]{article}
\usepackage[a4paper,top=3cm,bottom=4cm,left=3.8cm,right=3.8cm]{geometry}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{comment}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage{physics}
\usepackage{bm}
  
\theoremstyle{definition}  
\newtheorem*{defn}{Definizione}  
\newtheorem*{prop}{Proposizione} 
\newtheorem*{oss}{Osservazione}
\newtheorem {prob}{Problema}


\SetLabelAlign{Center}{\hfil#1\hfil}

\newenvironment{rcases}
{\left.\begin{aligned}}
	{\end{aligned}\right\rbrace}

\begin{document}
\title{Formulario per il progetto NAPDE}
\author{Matteo Calaf√† e Federica Botta}
\maketitle
\vspace{5mm}
\section{Monodominio}
\vspace{5mm}
\subsection{Modelli analitici}
\vspace{5mm}
\paragraph{Modello del monodominio}
	\begin{equation}
	\begin{cases}
	\chi_m C_m\pdv{V_m}{t} - \nabla \cdot (\Sigma \nabla V_m) + \chi_m I_{ion}(V_m,w) = I^{ext}    & \text{in } \Omega_{mus} \cross (0,T]
	\\
	\pdv{w}{t} = g(V\ped{m}, w)  & \text{in } \Omega_{mus} \cross (0,T]
	\\
	\Sigma\nabla V\ped{m} \cdot n = b   & \text{on } \partial \Omega_{mus} \cross (0,T]
	\end{cases}
	\end{equation}
	\vspace{4mm}\newline
	dove le incognite sono:
	\begin{itemize}
		\item $V_m$ = $\Phi_i - \Phi_e$ (differenza tra potenziale interno e esterno)
		\item $w$  ("\emph{gating variable}")
	\end{itemize}
    e sono date le costanti : $\chi_m, C_m, \Sigma$



\paragraph{Modello di FitzHugh-Nagumo}
\begin{equation}
\begin{gathered}
I_{ion}(V_m, w) = -kV_m(V_m-a)(V_m-1) -w
\\
g(V_m,w) = \epsilon(V_m -\gamma w)
\end{gathered}
\end{equation}

\vspace{5mm}

\subsection{Modello numerico semi-discretizzato}

	\vspace{5mm}
	 \begin{equation}
	 \begin{rcases}
	 V_{ij} &= \int_{\Omega}\nabla\varphi_j \cdot \nabla \varphi_i 
	 \\ I_{i,j}^T &= \sum_{F \in F_h^I} \int_{F} \{\{\nabla\varphi_j\}\} \cdot [[\varphi_i]] 
	\\ I_{i,j} &= \sum_{F \in F_h^I} \int_{F} [[\varphi_j]] \cdot \{\{\nabla \varphi_i\}\}
	 \\S_{i,j} &= \sum_{F \in F_h^I} \int_{F} \gamma [[\varphi_j]] \cdot [[\varphi_i]]]
	 \end{rcases}
	 \quad A = \Sigma(V -I^T - \delta I + S)
	\end{equation}
	\begin{equation}
	M_{ij} = \sum_{K \in \tau_h}\int_K
	\varphi_j\varphi_i
	\end{equation}
	\begin{equation}
	C(u_h)_{ij} = - \sum_{K \in \tau_h} \int_K \chi_m k(u_h-1)(u_h-a)\varphi_j\varphi_i
	\end{equation}
	\begin{equation}
	F_i = \int_{\Omega} f\varphi_i - \sum_{F \in F_h^B} \int_F b\varphi_i
	\end{equation}
	
	\vspace{3mm}
\paragraph{Problema semi-discretizzato} 

\begin{equation*}
\begin{gathered}
\{\varphi_j\}_{j=1}^{N_h} \text{ base di } V_h^p = \{v_h \in L^2 : v_h|_K \in \mathbb{P}^{p_k}(K) \quad p_k \leq p \quad \forall K \in \tau_h \}
\\
u_h(t) = \sum_{j=1}^{N_h} u_j(t)\varphi_j, \quad w_h(t) = \sum_{j=1}^{N_h}w_j(t)\varphi_j
\end{gathered}
\end{equation*}
\vspace{3mm}
\begin{equation}
\Rightarrow \quad  \begin{gathered}\boxed{\chi_mC_m M \dot{u} +  A u + C(u_h) u -\chi_mMw=F}
	\\
	\boxed{\dot{w} = \epsilon(u-\gamma w)}
	\end{gathered}
\end{equation}
\vspace{5mm}
\subsection{Modello numerico totalmente discretizzato ("$\bm{\theta-method}$")}
\vspace{5mm}
\paragraph{Forma implicita $(\theta \in [0,1])$}
\begin{enumerate}
	\item
	\begin{equation}
	\begin{gathered}
	\chi_mC_m M \frac{u^{k+1}-u^k}{\Delta t} +  A \left(\theta u^{k+1} + (1-\theta)u^k \right) + C(u^k)\left(\theta u^{k+1} + (1-\theta)u^k \right) +
	\\ -\chi_mMw^{k+1}=\theta F^{k+1} + (1-\theta)F^k
	\end{gathered}
	\end{equation}
	\item
	\begin{equation}
	\frac{w^{k+1}- w^{k}}{\Delta t} = \epsilon(u^k-\gamma w^{k+1})
	\end{equation}
\end{enumerate}
\vspace{3mm}
\paragraph{Forma esplicita $(\theta \in [0,1])$}
\begin{enumerate}
	\item
	\begin{equation}
	\begin{gathered}
	\left[\chi_mC_mM+\theta \Delta t A + \theta \Delta t C(u^k) \right] \bm{u^{k+1}} = \theta\Delta t F^{k+1} + (1-\theta)\Delta tF^k +
	\\
	\left[\chi_mC_mM- (1-\theta)\Delta t A - (1-\theta)\Delta t C(u^k)\right] u^k +\chi_m\Delta t Mw^{k+1} 
	\end{gathered}
	\end{equation}
	\item
	\begin{equation}
	\left[1+ \epsilon \gamma \Delta t\right] \bm{w^{k+1}} = w^k + (\epsilon \Delta t) u^k
	\end{equation}
\end{enumerate}







\newpage

\section{Bidominio}
\vspace{5mm}
\subsection{Modelli analitici}
\vspace{5mm}
\paragraph{Modello del bidominio}
\begin{equation}
\begin{cases}
\chi_m C_m\pdv{V_m}{t} - \nabla \cdot (\Sigma_i \nabla \phi_i) + \chi_m I_{ion}(V_m,w) = I_i^{ext}    & \text{in } \Omega_{mus} \cross (0,T]
\\
-\chi_m C_m\pdv{V_m}{t} - \nabla \cdot (\Sigma_e \nabla \phi_e) - \chi_m I_{ion}(V_m,w) = -I_e^{ext}    & \text{in } \Omega_{mus} \cross (0,T]
\\
\pdv{w}{t} = g(V\ped{m}, w)  & \text{in } \Omega_{mus} \cross (0,T]
\\
\Sigma_i\nabla \phi_i \cdot n = b_i   & \text{on } \partial \Omega_{mus} \cross (0,T]
\\
\Sigma_e\nabla \phi_e \cdot n = b_e   & \text{on } \partial \Omega_{mus} \cross (0,T]
\end{cases}
\end{equation}
\vspace{4mm}\newline
dove le incognite sono:
\begin{itemize}
	\item $\phi_i, \phi_e$  $\quad (V_m = \phi_i-\phi_e$)
	\item $w$  ("\emph{gating variable}")
\end{itemize}
e sono date le costanti : $\chi_m, C_m, \Sigma_i, \Sigma_e$

\paragraph{Modello di FitzHugh-Nagumo}
\begin{equation}
\begin{gathered}
I_{ion}(V_m, w) = -kV_m(V_m-a)(V_m-1) -w
\\
g(V_m,w) = \epsilon(V_m -\gamma w)
\end{gathered}
\end{equation}

\vspace{5mm}

\subsection{Modello numerico semi-discretizzato}

\vspace{5mm}
\begin{equation}
\begin{rcases}
V_{ij} &= \int_{\Omega}\nabla\varphi_j \cdot \nabla \varphi_i 
\\ I_{i,j}^T &= \sum_{F \in F_h^I} \int_{F} \{\{\nabla\varphi_j\}\} \cdot [[\varphi_i]] 
\\ I_{i,j} &= \sum_{F \in F_h^I} \int_{F} [[\varphi_j]] \cdot \{\{\nabla \varphi_i\}\}
\\S_{i,j} &= \sum_{F \in F_h^I} \int_{F} \gamma [[\varphi_j]] \cdot [[\varphi_i]]]
\end{rcases}
\begin{gathered}
\quad A = (V -I^T - \theta I + S)\\
\quad A_i = \Sigma_iA \\
\quad A_e = \Sigma_eA
\end{gathered}
\end{equation}
\begin{equation}
M_{ij} = \sum_{K \in \tau_h}\int_K
\varphi_j\varphi_i
\end{equation}
\begin{equation}
C(u_h)_{ij} = - \sum_{K \in \tau_h} \int_K \chi_m k(u_h-1)(u_h-a)\varphi_j\varphi_i
\end{equation}
\begin{equation}
\begin{gathered}
F_{i,k} = \int_{\Omega} I_i^{ext}\varphi_k - \sum_{F \in F_h^B} \int_F b_i\varphi_k
\\
F_{e,k} = - \int_{\Omega} I_e^{ext}\varphi_k - \sum_{F \in F_h^B} \int_F b_e\varphi_k
\end{gathered}
\end{equation}


	\vspace{3mm}
\paragraph{Problema semi-discretizzato} 

\begin{equation*}
\begin{gathered}
\{\varphi_j\}_{j=1}^{N_h} \text{ base di } V_h^k = \{v_h \in L^2 : v_h|_\mathcal{K} \in \mathbb{P}^{k}(\mathcal{K})  \quad \forall \mathcal{K} \in \tau_h \}
\\
\Phi_h(t) = \begin{bmatrix} \Phi_i^h(t) \\ \Phi_e^h(t) \end{bmatrix} = \begin {bmatrix}\sum_{j=1}^{N_h} \Phi_{i,j}(t)\varphi_j \\ \sum_{j=1}^{N_h} \Phi_{e,j}(t)\varphi_j \end{bmatrix},
 \quad w_h(t) = \sum_{j=1}^{N_h}w_j(t)\varphi_j
\end{gathered}
\end{equation*}
\vspace{3mm}
\begin{equation}
\Rightarrow \quad
\boxed{
\begin{gathered}
 \chi_mC_m \begin{bmatrix}M &-M \\ -M & M \end{bmatrix}
	\begin{bmatrix}\bm{\dot{\Phi}_i^h(t)} \\ \bm{\dot{\Phi}_e^h(t)} \end{bmatrix}
	 + \begin{bmatrix}A_i & 0 \\ 0 & A_e \end{bmatrix}
	 \begin{bmatrix}\bm{\Phi_i^h(t)} \\ \bm{\Phi_e^h(t)} \end{bmatrix} +\\
	   \begin{bmatrix}C(V_m^h) & -C(V_m^h) \\ -C(V_m^h) & C(V_m^h) \end{bmatrix} 
	   \begin{bmatrix} \bm{\Phi_i^h(t)} \\ \bm{\Phi_e^h(t)}  \end{bmatrix} 
	   -\chi_m \begin{bmatrix}M & 0 \\ 0 & -M \end{bmatrix} 
	   	\begin{bmatrix}w_h(t) \\ w_h(t) \end{bmatrix} = 
	   	\begin{bmatrix} F_i^h \\ F_e^h\end{bmatrix}
\end{gathered}
}
\end{equation}
\begin{equation}
\boxed{\dot{w}_h(t) = \epsilon(V_m^h(t) - \gamma w_h(t))}
\end{equation}
\vspace{5mm}

\subsection{Modelli numerici totalmente discretizzati}
\vspace{4mm}
\subsubsection{Metodo semi-implicito}
\paragraph{Forma implicita}
\begin{equation}
\begin{gathered}
\chi_mC_m \begin{bmatrix}M &-M \\ -M & M \end{bmatrix}
\begin{bmatrix}\frac{\Phi_i^{k+1}-\Phi_i^k}{\Delta t} \\ \frac{\Phi_e^{k+1}-\Phi_e^k}{\Delta t} \end{bmatrix}
+ \begin{bmatrix}A_i & 0 \\ 0 & A_e \end{bmatrix}
\begin{bmatrix}\Phi_i^{k+1} \\ \Phi_e^{k+1} \end{bmatrix} + \\
 \begin{bmatrix}C(V_m^k) & -C(V_m^k) \\ -C(V_m^k) & C(V_m^k) \end{bmatrix} 
\begin{bmatrix} \Phi_i^{k+1} \\ \Phi_e^{k+1}  \end{bmatrix} 
-\chi_m \begin{bmatrix}M & 0 \\ 0 & -M \end{bmatrix} 
\begin{bmatrix}w^{k+1} \\ w^{k+1} \end{bmatrix} = 
\begin{bmatrix} F_i^{k+1} \\ F_e^{k+1}\end{bmatrix}
\end{gathered}
\end{equation}
\vspace{5mm}
\begin{equation}
\frac{w^{k+1}-w^k}{\Delta t} = \epsilon (V_m^k - \gamma w^{k+1})
\end{equation}

\paragraph{Forma esplicita}
\begin{equation}
\begin{gathered}
\left( \frac{\chi_m C_m}{\Delta t} \begin{bmatrix} M & -M \\ -M & M \end{bmatrix} + \begin{bmatrix} A_i & 0 \\ 0 & A_e \end{bmatrix} + 
\begin{bmatrix}
C(V_m^k) & -C(V_m^k) \\ -C(V_m^k) & C(V_m^k)
\end{bmatrix}\right)
\begin{bmatrix} \bm{\Phi_i^{k+1}} \\ \bm{\Phi_e^{k+1}} \end{bmatrix} = 
\\
\begin{bmatrix} F_i^{k+1} \\ F_e^{k+1} \end{bmatrix} 
+ \chi_m \begin{bmatrix}M & 0 \\ 0 & -M \end{bmatrix}
\begin{bmatrix} w^{k+1} \\ w^{k+1} \end{bmatrix}
+ \frac{\chi_m C_m}{\Delta t} \begin{bmatrix}M & -M \\ -M & M\end{bmatrix}
\begin{bmatrix} \Phi_i^{k} \\ \Phi_e^{k} \end{bmatrix}
\end{gathered}
\end{equation}

\vspace{5mm}
\begin{equation}
(1+\epsilon \gamma \Delta t)w^{k+1} = w^k + \epsilon \Delta t V_m^k
\end{equation}

\newpage
\subsubsection{Operator Splitting quasi-implicito}
\paragraph{Forma implicita}
\begin{enumerate}[label = \Roman*, align = Center]
	\item 
	\begin{equation}
	\begin{gathered}
	\chi_m C_m M \frac{\tilde{V}_m^{n+1}-V_m^n}{\Delta t} +  C(V_m^n) V_m^{n+1} - \chi_m M w^{n+1}= 0
	\\
	 \frac{w^{n+1} - w^n}{\Delta t} = \epsilon (V_m^{n+1}-\gamma w^{n+1})
	\end{gathered}
	\end{equation}
	\item 
	\begin{equation}
	\begin{gathered}
	\chi_m C_m M \frac{V_m^{n+1}-\tilde{V}_m^{n+1}}{\Delta t} + A_i \Phi_i^{n+1}= F_i^{n+1}
	\\
	- \chi_m C_m M \frac{V_m^{n+1}-\tilde{V}_m^{n+1}}{\Delta t} + A_e \Phi_e^{n+1}= F_e^{n+1}
	\end{gathered}
	\end{equation}
	
\end{enumerate}
\vspace{5mm}
\paragraph{Forma esplicita}
\begin{equation}
\vspace{5mm}
\begin{cases}
\chi_m C_m M \frac{V_m^{n+1}-V_m^{n}}{\Delta t} + C(V_m^n) V_m^{n+1} - \chi_m M w^{n+1} + A_i \Phi_i ^{n+1} = F_i^{n+1} \\
\chi_m C_m M \frac{V_m^{n+1}-V_m^{n}}{\Delta t} +  C(V_m^n) V_m^{n+1} - \chi_m M w^{n+1} - A_e \Phi_e ^{n+1} =  -F_e^{n+1} \\
\frac{w^{n+1}-w^{n}}{\Delta t} = \epsilon(V_m^{n+1}-\gamma w^{n+1})
\end{cases}
\end{equation}

 \begin{equation}
 \begin{gathered}
 \begin{aligned}
 & \bullet \quad Q_n := \frac{\chi_m C_m}{\Delta t}M + C(V_m^n) - \frac{\epsilon\chi_m \Delta t}{1 + \epsilon \gamma \Delta t} M \\
 & \bullet \quad R_n := \frac{\chi_mC_m}{\Delta t}MV_m^n + \frac{\chi_m}{1+\epsilon\gamma\Delta t}M w^n
 \end{aligned}
 \end{gathered}
\end{equation}

\vspace{5mm}
\begin{enumerate}
	\item 
	\begin{equation}
	\begin{gathered}
	\chi_m C_m M \frac{	\Phi_i^{n+1}-\Phi_e^{n+1}-V_m^{n}}{\Delta t} +  C(V_m^n) (\Phi_i^{n+1}-\Phi_e^{n+1}) + \\ - \chi_m M \left(\frac{w^n + \epsilon \Delta t (\Phi_i^{n+1}-\Phi_e^{n+1})}{1+\epsilon \gamma \Delta t}   \right) + A_i \Phi_i ^{n+1} = F_i^{n+1} \\ \\
     \Rightarrow \quad (Q_n + A_i) \Phi_i^{n+1} - Q_n \Phi_e^{n+1} =R_n +  F_i^{n+1}
	\end{gathered}
	\end{equation}
	
    \item 
	\begin{equation}
	\begin{gathered}
	\chi_m C_m M \frac{	\Phi_i^{n+1}-\Phi_e^{n+1}-V_m^{n}}{\Delta t} + \cdot C(V_m^n) (\Phi_i^{n+1}-\Phi_e^{n+1}) + \\ -  \chi_m M \left(\frac{w^n + \epsilon \Delta t (\Phi_i^{n+1}-\Phi_e^{n+1})}{1+\epsilon \gamma \Delta t}   \right) - A_e \Phi_e ^{n+1} = -F_e^{n+1} \\ \\
	\Rightarrow \quad Q_n \Phi_i^{n+1} - (Q_n+A_e) \Phi_e^{n+1} =R_n - F_e^{n+1}
	\end{gathered}
	\end{equation}
	\vspace{3mm}
	\item 
	\begin{equation}
	w^{n+1} = \frac{w^n + \epsilon \Delta t (\Phi_i^{n+1}-\Phi_e^{n+1})}{1+\epsilon \gamma \Delta t}
	\end{equation}
\end{enumerate}


\begin{equation}
\Rightarrow \quad
\begin{cases}
\left(
\begin{bmatrix} Q_n & -Q_n \\ Q_n & -Q_n \end{bmatrix} + 
\begin{bmatrix} A_i & 0 \\ 0 & -A_e\end{bmatrix}
\right)
\begin{bmatrix}
\bm{\Phi_i^{n+1}} \\ \bm{\Phi_e^{n+1}}
\end{bmatrix}
= \begin{bmatrix} R_n \\ R_n \end{bmatrix} + \begin{bmatrix} F_i^{n+1} \\  -F_e^{n+1}\end{bmatrix} \\ \\
Q_n = \frac{\displaystyle \chi_m C_m}{\displaystyle \Delta t}M +  \cdot C(V_m^n) - \frac{\displaystyle \epsilon\chi_m \Delta t}{\displaystyle 1 + \epsilon \gamma \Delta t}M \\ \\
R_n := \frac{\displaystyle \chi_mC_m}{\displaystyle \Delta t}MV_m^n + \frac{\displaystyle \chi_m}{\displaystyle 1+\epsilon\gamma\Delta t}M w^n \\ \\
w^{n+1} = \frac{\displaystyle w^n + \epsilon \Delta t (\Phi_i^{n+1}-\Phi_e^{n+1})}{\displaystyle 1+\epsilon \gamma \Delta t}
\end{cases}
\end{equation}


\vspace{5mm}
\subsubsection{Operator Splitting di Godunov}
\paragraph{Forma implicita}
\begin{enumerate}[label = \Roman*, align = Center]
\item 
   \begin{equation}
   \begin{gathered}
   \chi_m C_m M\frac{\hat{V}_m^{n+1} - V_m^n}{\Delta t} + C(V_m^n)V_m^n -\chi_mMw^n = 0
   \\
   \frac{w^{n+1}-w^n}{\Delta t} = \epsilon (V_m^n - \gamma w^n)
   \end{gathered}
   \end{equation}
\item 
   \begin{equation}
   \begin{gathered}
   \chi_m C_m M\frac{V_m^{n+1} - \hat{V}_m^{n+1}}{\Delta t} + A_i\Phi_i^{n+1} = F_i^{n+1} \\
   -\chi_m C_m M\frac{V_m^{n+1} - \hat{V}_m^{n+1}}{\Delta t} + A_e\Phi_e^{n+1} = F_e^{n+1}
   \end{gathered}
   \end{equation}
\end{enumerate}
\vspace{3mm}
\paragraph{Forma esplicita}

\begin{equation}
\begin{gathered}
\begin{cases}
\chi_m C_m M\frac{V_m^{n+1} - V_m^n}{\Delta t} + C(V_m^n)V_m^n -\chi_mMw^n + A_i \Phi_i^{n+1}= F_i^{n+1} \\
\chi_m C_m M\frac{V_m^{n+1} - V_m^n}{\Delta t} + C(V_m^n)V_m^n -\chi_mMw^n - A_e \Phi_e^{n+1}= -F_e^{n+1} \\
w^{n+1} = (1-\epsilon \gamma \Delta t) w^n + \epsilon \Delta t V_m^n
\end{cases}
\\ \\  
\Rightarrow
\begin{cases}
\left( \frac{\chi_m C_m}{\Delta t} M + A_i \right ) \Phi_i^{n+1} - \frac{\chi_m C_m}{\Delta t} M \Phi_e^{n+1} = F_i^{n+1} + \chi_m M w^n + \left( \frac{\chi_m C_m}{\Delta t} M- C(V_m^n)\right) V_m^n \\ 
\frac{\chi_m C_m}{\Delta t} M  \Phi_i^{n+1} - \left(\frac{\chi_m C_m}{\Delta t} M + A_e \right) \Phi_e^{n+1} =  -F_e^{n+1} + \chi_m M w^n + \left( \frac{\chi_m C_m}{\Delta t} M- C(V_m^n)\right) V_m^n \\
w^{n+1} = (1-\epsilon \gamma \Delta t) w^n + \epsilon \Delta tV_m^n
\end{cases}
\end{gathered} 
\end{equation}
\vspace{3mm}
\begin{equation}
\Rightarrow \quad 
\begin{cases}
\begin{gathered}
\left(
	\frac{\chi_m C_m}{\Delta t} \begin{bmatrix}M & -M \\ M & -M\end{bmatrix}
	+ \begin{bmatrix} A_i & 0 \\ 0 & -A_e \end{bmatrix}
	\right) \begin{bmatrix} \bm{\Phi_i^{n+1}} \\ \bm{\Phi_e^{n+1}}  \end{bmatrix} =
	\begin{bmatrix} F_i^{n+1} \\ -F_e^{n+1} \end{bmatrix} + \\
	\chi_m\begin{bmatrix} M & 0 \\ 0 & M \end{bmatrix} \begin{bmatrix} w^n \\ w^n \end{bmatrix} +
	\left(\frac{\chi_mC_m}{\Delta t}\begin{bmatrix} M & 0 \\ 0 & M \end{bmatrix}
	- \begin{bmatrix} C(V_m^n) & 0 \\ 0 & C(V_m^n)\end{bmatrix} 
	\right) \begin{bmatrix} V_m^n \\ V_m^n \end {bmatrix}
	 \end{gathered} \\ \\
	w^{n+1} = (1-\epsilon \gamma \Delta t) w^n + \epsilon \Delta tV_m^n
\end{cases}
\end{equation}



\end{document}